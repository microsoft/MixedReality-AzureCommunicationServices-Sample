# Complete Web App Registration Setup
In the [previous step](./azure-function-setup-5.md#adding-aad-authentication) a new web app registration was created when adding the Function App's Microsoft identity provider. Take time to verify and understand the new app registration's configuration.

To view the app registration's configuration:

1. Go to the [Azure Portal](https://portal.azure.com).
   
2. Go to the [Azure Active Directory](https://portal.azure.com/#blade/Microsoft_AAD_IAM/ActiveDirectoryMenuBlade) blade.
   
3. Go to the [App registrations](https://portal.azure.com/#view/Microsoft_AAD_IAM/ActiveDirectoryMenuBlade/~/RegisteredApps) section.

4. Search for the existing app registration that was created in the previous [step](azure-function-setup-5.md#adding-aad-authentication). 
   
5. Alternatively, click the link under the [Function App's](https://portal.azure.com/#view/HubsExtension/BrowseResource/resourceType/Microsoft.Web%2Fsites/kind/functionapp) **Settings > Authentication** section.
   
   ![Screenshot showing the Azure Function App authentication panel in the Azure Portal](./images/image-100-web-app-function-app.png)

6. Go the **Overview** section of your new app registration. 
   
7. Copy and save the **Application (client) ID** and the **Directory (tenant) ID**. These values will be needed in a later step.
   
   ![Screenshot showing the web app registration's overview within the Azure Portal](./images/image-102-web-app-function-app.png)

8. Go to the **Manage > Authentication** section.

9.  Expand the **Web** heading. 
   
10. Verify that the redirect URIs contain a URI for the newly create Function App resource. For example, `https://{your-azure-function-name}.azurewebsites.net/.auth/login/aad/callback`.

11. Also, verify that the **Supported account types** has been set to desired value, either **Single-tenant** or **Multi-tenant**.  It is not required that the app registration support multi-tenant scenarios, however this walk-through assumes you'll be using multi-tenant accounts for the sample app.
   
   ![Screenshot showing the web app registration's authentication settings within the Azure Portal](./images/image-12-web-app-mt.png)

11. Continue by going to the **Manage > Certificates & secrets** section.
    
12. Verify there is a secret named **Generated by App Service**. This secret is used by the Function App during authentication. If it missing, authentication will not work.
    
    ![Screenshot showing the web app registration's certificates & secrets settings within the Azure Portal](./images/image-13-web-app.png)

13. Under the **Manage > API permissions** section, verify the app permissions. 
    
14. Verify that the Microsoft Graph permission **User.Read** is present. If missing add this permission via the **Add permission** button. This is permission is needed for the Function App resource to obtain the user's tenant information. If your application requires additional permissions, you may add them now.
    
    ![Screenshot showing the web app registration's api permission settings within the Azure Portal](./images/image-14-web-app.png)

15. Finally, go to **Manage > Expose an API** section, so to modify the application URI identifier.    
    
16. Notice that the default **Application ID URI** is set to `api://{apps-client-id}`. Since the URI only contains a client id, the API will only be accessible by users within the same tenant. Changes are needed to support multi-tenant accounts.     
    
17. If you are setting up a single-tenant application, skip to step 20.
    
18. Click the edit button next to the **Application ID URI**.
    
19. Update the **Application ID URI** so that it contains the Directory (tenant) id copied at <a href="#item4">step 4</a>. The tenant id must be before the client id, separated by a slash; for example, `api://{apps-tenant-id}/{apps-client-id}`. The URI can be set to `https://**apps-tenant-name}.onmicrosoft.com/{unique-app-name}`, but for simplicity use the API schema during this walk-through. 

    > Note, Application ID URIs using *http* or *https* will not work with the sample app's WAM implementation, if both the web and native apps share the same AAD application registration. It won't work because when the application (client) uses WAM to request a resource permission from itself, the *resource* parameter has to be set to the *application (client) ID* guid, not the *Application ID Uri* (or *resource URI*). The sample app correctly handles this case for the *api* schema, but not the *http* or *https* schemas.
    
    ![Screenshot showing the web app registration's expose an api settings within the Azure Portal](./images/image-15-web-app.png)
    
    > Visit the [Application ID URI](https://docs.microsoft.com/en-us/azure/active-directory/develop/security-best-practices-for-app-registration#application-id-uri) document for more information on this URI.

20. Verify there's a default scope called **user_impersonation**. This scope should have automatically been added when creating the Function App's identity provider.
    
22. The native application will request a token with this scope when accessing the Function App. The scope URI can be `api://{apps-tenant-id}/{apps-client-id}/user_impersonation` if this is a multi-tenant or single-tenant application. The scope URI may also be `api://{apps-client-id}/user_impersonation` if this is a single-tenant application.
    
23. Copy and save the **Application ID URI** and the **scope URI** for later.

## Next Step
The next, [Update Function App's Token Audience](./azure-function-setup-7.md#update-function-apps-token-audience), describes how to change the Function App's token audience. Since the resource (or Application ID) URI was changed in this step, we'll have to update this token audience (i.e. the resource URI). If you did not change the **Application ID URI**, you may skip to the [Complete Web App Registration Setup](./azure-function-setup-8.md#more-function-app-configuration) step.